<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Сканирование сети - АСДУЕ</title>
    <style>
        body { font-family: Arial; padding: 20px; }
        .controls { margin: 20px 0; }
        .btn { padding: 10px 20px; margin-right: 10px; border: none; cursor: pointer; }
        .start-btn { background: #2ecc71; color: white; }
        .stop-btn { background: #e74c3c; color: white; }
        .progress-container { margin: 30px 0; }
        .progress-bar { width: 100%; height: 30px; background: #ecf0f1; border-radius: 15px; overflow: hidden; }
        .progress-fill { height: 100%; background: #3498db; width: 0%; transition: width 0.3s; }
        .status { margin: 20px 0; padding: 15px; background: #f8f9fa; border-radius: 5px; }
        .results-link { display: inline-block; margin-top: 20px; padding: 10px 15px; background: #9b59b6; color: white; text-decoration: none; }
    </style>
    <script>
        function updateProgress() {
            fetch('/scan/status')
                .then(response => response.json())
                .then(data => {
                    // Обновляем прогресс-бар
                    document.getElementById('progressFill').style.width = data.progress + '%';
                    document.getElementById('progressText').textContent = data.progress + '%';
                    
                    // Обновляем статус
                    document.getElementById('currentNetwork').textContent = 
                        data.current_network || 'Ожидание...';
                    document.getElementById('networksScanned').textContent = 
                        data.scanned_networks + ' / ' + data.total_networks;
                    
                    // Обновляем состояние кнопок
                    document.getElementById('startBtn').disabled = data.is_scanning;
                    document.getElementById('stopBtn').disabled = !data.is_scanning;
                    
                    // Если сканирование идет, продолжаем обновлять
                    if (data.is_scanning) {
                        setTimeout(updateProgress, 1000);
                    }
                });
        }
        
        function startScan() {
            fetch('/scan', { method: 'POST' })
                .then(response => response.json())
                .then(data => {
                    if (data.status === 'started') {
                        // Начинаем обновление прогресса
                        updateProgress();
                    }
                });
        }
        
        function stopScan() {
            fetch('/api/scan/stop', { method: 'POST' })
                .then(response => response.json());
        }
        
        // Запускаем обновление прогресса при загрузке страницы
        document.addEventListener('DOMContentLoaded', function() {
            updateProgress();
        });
    </script>
</head>
<body>
    <div style="margin-bottom: 20px;">
        <a href="/">← На главную</a> | 
        <a href="/networks">Настроить сети</a>
    </div>
    
    <h1>Сканирование сети</h1>
    
    <div class="controls">
        <button id="startBtn" class="btn start-btn" onclick="startScan()">Начать сканирование</button>
        <button id="stopBtn" class="btn stop-btn" onclick="stopScan()" disabled>Остановить</button>
    </div>
    
    <div class="progress-container">
        <h3>Прогресс сканирования: <span id="progressText">0%</span></h3>
        <div class="progress-bar">
            <div class="progress-fill" id="progressFill"></div>
        </div>
    </div>
    
    <div class="status">
        <p><strong>Текущая сеть:</strong> <span id="currentNetwork">Ожидание...</span></p>
        <p><strong>Сетей отсканировано:</strong> <span id="networksScanned">0 / 0</span></p>
    </div>
    
    <a href="/results" class="results-link">Просмотреть результаты →</a>
</body>
</html>